name: Sync Upstream

on:
  schedule:
    - cron: '0 * * * *' # 매시간 정각에 동기화 실행
  workflow_dispatch: # 버튼을 눌러 수동으로 즉시 실행 가능

jobs:
  sync:
    if: github.repository == 'betalab-biz/betalab-frontend'
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Sync check
        uses: actions/checkout@v4
        with:
          ref: develop # 포크 레포의 대상 브랜치
          fetch-depth: 0
          token: ${{ github.token }} 

      - name: Update from Upstream
        run: |
          # Git 사용자 설정 (merge 시 필요)
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # 4. 원본 레포지토리 등록 및 가져오기
          # 원본 레포 등록 (이미 등록되어 있을 수 있으므로 에러 무시 처리)
          git remote add upstream https://github.com/PROJECT-NEXUS-JS/betalab-frontend.git || git remote set-url upstream https://github.com/PROJECT-NEXUS-JS/betalab-frontend.git
          git fetch upstream develop

          # 3. 로컬 develop 브랜치로 이동 및 원본과 병합
          git checkout develop
          git merge upstream/develop

          # 4. 포크 레포로 푸시
          git push origin develop
